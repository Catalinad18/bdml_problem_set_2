p_load(tidyverse,
rio,
tidymodels,
glmnet,
stargazer,
dplyr,
plotly,
leaflet,
rgeos,
tmaptools,
sf,
osmdata)
file_dir <- this.path::here()
setwd(file_dir)
df <- read_csv("../stores/train.csv")
df_test <- read_csv(("../stores/test.csv"))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
#Normalización
#Pasamos todo a minúscula
df <- df %>%
mutate(description = str_to_lower(description))
df_test <- df_test %>%
mutate(description = str_to_lower(description))
#Eliminamos tildes
df <- df %>%
mutate(description = iconv(description, from = "UTF-8", to = "ASCII//TRANSLIT"))
df_test <- df_test %>%
mutate(description = iconv(description, from = "UTF-8", to = "ASCII//TRANSLIT"))
#Eliminamos caracteres especiales que no sean alfanuméricos
df <- df %>%
mutate(description = str_replace_all(description, "[^[:alnum:]]", " "))
df_test <- df_test %>%
mutate(description = str_replace_all(description, "[^[:alnum:]]", " "))
#Eliminamos espacios extras
df <- df %>%
mutate(description = str_trim(gsub("\\s+", " ", description)))
df_test <- df_test %>%
mutate(description = str_trim(gsub("\\s+", " ", description)))
df <- df %>%
mutate(property_type_2 = ifelse(grepl("apto|apartamento|pent house", description), "apartamento", property_type))
df <- df %>%
mutate(property_type_2 = ifelse(grepl("casa", description), "casa", property_type)) %>%
select(-property_type)
df_test <- df_test %>%
mutate(property_type_2 = ifelse(grepl("apto|apartamento|pent house", description), "apartamento", property_type))
df_test <- df_test %>%
mutate(property_type_2 = ifelse(grepl("casa", description), "casa", property_type)) %>%
select(-property_type)
df <- df %>%
mutate(property_type = case_when(property_type_2 == "apartamento" ~ 0,
property_type_2 == "Apartamento" ~ 0,
property_type_2 == "Casa" ~ 1,
property_type_2 == "casa" ~ 1)
)
#test
df_test <- df_test %>%
mutate(property_type = case_when(property_type_2 == "apartamento" ~ 0,
property_type_2 == "Apartamento" ~ 0,
property_type_2 == "Casa" ~ 1,
property_type_2 == "casa" ~ 1)
)
df <- df %>%
mutate(piso_info = str_extract(description, "(\\w+|\\d+) piso (\\w+|\\d+)"))
df_test <- df_test %>%
mutate(piso_info = str_extract(description, "(\\w+|\\d+) piso (\\w+|\\d+)"))
numeros_escritos <- c("uno|primer|primero", "dos|segund|segundo", "tres|tercer|tercero", "cuatro|cuarto", "cinco|quinto", "seis|sexto", "siete|septimo", "ocho|octavo", "nueve|noveno", "diez|decimo", "once|undecimo|onceavo", "doce|duodecimo|doceavo|doseavo", "trece|trese|treceavo|treseavo", "catorce|catorse|catorceavo|catorseavo", "quince|quinse|quinceavo|quinseavo")
numeros_numericos <- as.character(1:15)
df <- df %>%
mutate(piso_info = str_replace_all(piso_info, setNames(numeros_numericos, numeros_escritos)))
df_test <- df_test %>%
mutate(piso_info = str_replace_all(piso_info, setNames(numeros_numericos, numeros_escritos)))
df <- df %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
#Eliminamos datos extraños de piso
df <- df %>%
mutate(piso_numerico = ifelse(piso_numerico > 40, NA, piso_numerico))
df_test <- df_test %>%
mutate(piso_numerico = ifelse(piso_numerico > 40, NA, piso_numerico))
#Imputamos moda para valores faltantes de piso, en caso de que se trate de una casa
df %>%
filter(property_type_2 == "Apartamento") %>%
count(piso_numerico)
#La moda es 2
df_test %>%
filter(property_type_2 == "Apartamento") %>%
count(piso_numerico)
#La moda es 2
df <- df %>%
mutate(piso_numerico = replace_na(piso_numerico, 2))
df_test <- df_test %>%
mutate(piso_numerico = replace_na(piso_numerico, 2))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
df_test <- df_test %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
area_escrita <- c("seis", "siete", "ocho", "nueve|nuebe", "diez|dies", "once|onse", "doce|dose", "trece|trese", "catorce|catorse", "quince|quinse", "dieciseis|diesiseis", "diecisiete|diesisiete", "dieciocho|diesiocho", "diecinueve|diesinueve", "veinte|beinte", "veintiun|beintiun|ventiun|bentiun", "veintidos|ventidos|bentidos|beintidos", "veintitres|ventitres|bentitres|beintitres", "veinticuatro|venticuatro|benticuatro|beinticuatro", "veinticinco|venticinco|beinticinco|benticinco", "veintiseis|ventiseis|beintiseis|bentiseis", "veintisiete|ventisiete|beintisiete|bentisiete", "veintiocho|ventiocho|beintiocho|bentiocho", "veintinueve|ventinueve|beintinueve|bentinueve")
area_numerica <- as.character(6:29)
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_escrita, area_numerica)))
df <- df %>%
mutate(area = as.integer(str_extract(area, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(area = ifelse(area > 1000| area < 25, NA, area))
df_test <- df_test %>%
mutate(area = ifelse(area > 10001 | area < 25, NA, area))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df_test <- df_test %>%
mutate(area = ifelse(area > 1000 | area < 25, NA, area))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(surface_total = replace_na(area))
df_test <- df_test %>%
mutate(surface_total = replace_na(area))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
View(df)
df$surface_total <- ifelse(is.na(df$surface_total), df$area, df$surface_total)
library(pacman)
p_load(tidyverse,
rio,
tidymodels,
glmnet,
stargazer,
dplyr,
plotly,
leaflet,
rgeos,
tmaptools,
sf,
osmdata)
file_dir <- this.path::here()
setwd(file_dir)
df <- read_csv("../stores/train.csv")
df_test <- read_csv(("../stores/test.csv"))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
#Normalización
#Pasamos todo a minúscula
df <- df %>%
mutate(description = str_to_lower(description))
df_test <- df_test %>%
mutate(description = str_to_lower(description))
#Eliminamos tildes
df <- df %>%
mutate(description = iconv(description, from = "UTF-8", to = "ASCII//TRANSLIT"))
df_test <- df_test %>%
mutate(description = iconv(description, from = "UTF-8", to = "ASCII//TRANSLIT"))
#Eliminamos caracteres especiales que no sean alfanuméricos
df <- df %>%
mutate(description = str_replace_all(description, "[^[:alnum:]]", " "))
df_test <- df_test %>%
mutate(description = str_replace_all(description, "[^[:alnum:]]", " "))
#Eliminamos espacios extras
df <- df %>%
mutate(description = str_trim(gsub("\\s+", " ", description)))
df_test <- df_test %>%
mutate(description = str_trim(gsub("\\s+", " ", description)))
df <- df %>%
mutate(property_type_2 = ifelse(grepl("apto|apartamento|pent house", description), "apartamento", property_type))
df <- df %>%
mutate(property_type_2 = ifelse(grepl("casa", description), "casa", property_type)) %>%
select(-property_type)
#test
df_test <- df_test %>%
mutate(property_type_2 = ifelse(grepl("apto|apartamento|pent house", description), "apartamento", property_type))
df_test <- df_test %>%
mutate(property_type_2 = ifelse(grepl("casa", description), "casa", property_type)) %>%
select(-property_type)
df <- df %>%
mutate(property_type = case_when(property_type_2 == "apartamento" ~ 0,
property_type_2 == "Apartamento" ~ 0,
property_type_2 == "Casa" ~ 1,
property_type_2 == "casa" ~ 1)
)
#test
df_test <- df_test %>%
mutate(property_type = case_when(property_type_2 == "apartamento" ~ 0,
property_type_2 == "Apartamento" ~ 0,
property_type_2 == "Casa" ~ 1,
property_type_2 == "casa" ~ 1)
)
df <- df %>%
mutate(piso_info = str_extract(description, "(\\w+|\\d+) piso (\\w+|\\d+)"))
df_test <- df_test %>%
mutate(piso_info = str_extract(description, "(\\w+|\\d+) piso (\\w+|\\d+)"))
numeros_escritos <- c("uno|primer|primero", "dos|segund|segundo", "tres|tercer|tercero", "cuatro|cuarto", "cinco|quinto", "seis|sexto", "siete|septimo", "ocho|octavo", "nueve|noveno", "diez|decimo", "once|undecimo|onceavo", "doce|duodecimo|doceavo|doseavo", "trece|trese|treceavo|treseavo", "catorce|catorse|catorceavo|catorseavo", "quince|quinse|quinceavo|quinseavo")
numeros_numericos <- as.character(1:15)
df <- df %>%
mutate(piso_info = str_replace_all(piso_info, setNames(numeros_numericos, numeros_escritos)))
df_test <- df_test %>%
mutate(piso_info = str_replace_all(piso_info, setNames(numeros_numericos, numeros_escritos)))
df <- df %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
#Eliminamos datos extraños de piso
df <- df %>%
mutate(piso_numerico = ifelse(piso_numerico > 40, NA, piso_numerico))
df_test <- df_test %>%
mutate(piso_numerico = ifelse(piso_numerico > 40, NA, piso_numerico))
#Imputamos moda para valores faltantes de piso, en caso de que se trate de una casa
df %>%
filter(property_type_2 == "Apartamento") %>%
count(piso_numerico)
#La moda es 2
df_test %>%
filter(property_type_2 == "Apartamento") %>%
count(piso_numerico)
#La moda es 2
df <- df %>%
mutate(piso_numerico = replace_na(piso_numerico, 2))
df_test <- df_test %>%
mutate(piso_numerico = replace_na(piso_numerico, 2))
df <- df %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
df_test <- df_test %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
area_escrita <- c("seis", "siete", "ocho", "nueve|nuebe", "diez|dies", "once|onse", "doce|dose", "trece|trese", "catorce|catorse", "quince|quinse", "dieciseis|diesiseis", "diecisiete|diesisiete", "dieciocho|diesiocho", "diecinueve|diesinueve", "veinte|beinte", "veintiun|beintiun|ventiun|bentiun", "veintidos|ventidos|bentidos|beintidos", "veintitres|ventitres|bentitres|beintitres", "veinticuatro|venticuatro|benticuatro|beinticuatro", "veinticinco|venticinco|beinticinco|benticinco", "veintiseis|ventiseis|beintiseis|bentiseis", "veintisiete|ventisiete|beintisiete|bentisiete", "veintiocho|ventiocho|beintiocho|bentiocho", "veintinueve|ventinueve|beintinueve|bentinueve")
area_numerica <- as.character(6:29)
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_escrita, area_numerica)))
df <- df %>%
mutate(area = as.integer(str_extract(area, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(area = ifelse(area > 1000| area < 25, NA, area))
df_test <- df_test %>%
mutate(area = ifelse(area > 1000 | area < 25, NA, area))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
View(df_test)
df <- df %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
df_test <- df_test %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
area_escrita <- c("seis", "siete", "ocho", "nueve|nuebe", "diez|dies", "once|onse", "doce|dose", "trece|trese", "catorce|catorse", "quince|quinse", "dieciseis|diesiseis", "diecisiete|diesisiete", "dieciocho|diesiocho", "diecinueve|diesinueve", "veinte|beinte", "veintiun|beintiun|ventiun|bentiun", "veintidos|ventidos|bentidos|beintidos", "veintitres|ventitres|bentitres|beintitres", "veinticuatro|venticuatro|benticuatro|beinticuatro", "veinticinco|venticinco|beinticinco|benticinco", "veintiseis|ventiseis|beintiseis|bentiseis", "veintisiete|ventisiete|beintisiete|bentisiete", "veintiocho|ventiocho|beintiocho|bentiocho", "veintinueve|ventinueve|beintinueve|bentinueve")
area_numerica <- as.character(6:29)
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_escrita, area_numerica)))
df <- df %>%
mutate(area = as.integer(str_extract(area, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
View(df_test)
df <- df %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
df_test <- df_test %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
area_escrita <- c("seis", "siete", "ocho", "nueve|nuebe", "diez|dies", "once|onse", "doce|dose", "trece|trese", "catorce|catorse", "quince|quinse", "dieciseis|diesiseis", "diecisiete|diesisiete", "dieciocho|diesiocho", "diecinueve|diesinueve", "veinte|beinte", "veintiun|beintiun|ventiun|bentiun", "veintidos|ventidos|bentidos|beintidos", "veintitres|ventitres|bentitres|beintitres", "veinticuatro|venticuatro|benticuatro|beinticuatro", "veinticinco|venticinco|beinticinco|benticinco", "veintiseis|ventiseis|beintiseis|bentiseis", "veintisiete|ventisiete|beintisiete|bentisiete", "veintiocho|ventiocho|beintiocho|bentiocho", "veintinueve|ventinueve|beintinueve|bentinueve")
area_numerica <- as.character(6:29)
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df <- df %>%
mutate(area = as.integer(str_extract(area, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(area = ifelse(area > 1000| area < 25, NA, area))
df_test <- df_test %>%
mutate(area = ifelse(area > 1000 | area < 25, NA, area))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
df_test <- df_test %>%
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
View(df_test)
area_escrita <- c("seis", "siete", "ocho", "nueve|nuebe", "diez|dies", "once|onse", "doce|dose", "trece|trese", "catorce|catorse", "quince|quinse", "dieciseis|diesiseis", "diecisiete|diesisiete", "dieciocho|diesiocho", "diecinueve|diesinueve", "veinte|beinte", "veintiun|beintiun|ventiun|bentiun", "veintidos|ventidos|bentidos|beintidos", "veintitres|ventitres|bentitres|beintitres", "veinticuatro|venticuatro|benticuatro|beinticuatro", "veinticinco|venticinco|beinticinco|benticinco", "veintiseis|ventiseis|beintiseis|bentiseis", "veintisiete|ventisiete|beintisiete|bentisiete", "veintiocho|ventiocho|beintiocho|bentiocho", "veintinueve|ventinueve|beintinueve|bentinueve")
area_numerica <- as.character(6:29)
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
View(df)
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
mutate(area = str_extract(description, "(\\d+|\\w+) mts|(\\d+|\\w+) m2|(\\d+|\\w+) metros|(\\d+|\\w+) metros cuadrados|(\\d+|\\w+) metros 2|(\\d+|\\w+) metros2"))
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
area_escrita <- c("seis", "siete", "ocho", "nueve|nuebe", "diez|dies", "once|onse", "doce|dose", "trece|trese", "catorce|catorse", "quince|quinse", "dieciseis|diesiseis", "diecisiete|diesisiete", "dieciocho|diesiocho", "diecinueve|diesinueve", "veinte|beinte", "veintiun|beintiun|ventiun|bentiun", "veintidos|ventidos|bentidos|beintidos", "veintitres|ventitres|bentitres|beintitres", "veinticuatro|venticuatro|benticuatro|beinticuatro", "veinticinco|venticinco|beinticinco|benticinco", "veintiseis|ventiseis|beintiseis|bentiseis", "veintisiete|ventisiete|beintisiete|bentisiete", "veintiocho|ventiocho|beintiocho|bentiocho", "veintinueve|ventinueve|beintinueve|bentinueve", "treinta", "treinta y uno", "treinta y dos", "treinta y tres", "treinta y cuatro", "treinta y cinco", "treinta y seis", "treinta y siete", "treinta y ocho", "treinta y nueve", "cuarenta", "cuarenta y uno", "cuarenta y dos", "cuarenta y tres", "cuarenta y cuatro", "cuarenta y cinco", "cuarenta y seis", "cuarenta y siete", "cuarenta y ocho", "cuarenta y nueve", "cincuenta", "cincuenta y uno", "cincuenta y dos", "cincuenta y tres", "cincuenta y cuatro", "cincuenta y cinco", "cincuenta y seis", "cincuenta y siete", "cincuenta y ocho", "cincuenta y nueve", "sesenta", "sesenta y uno", "sesenta y dos", "sesenta y tres", "sesenta y cuatro", "sesenta y cinco", "sesenta y seis", "sesenta y siete", "sesenta y ocho", "sesenta y nueve", "setenta", "setenta y uno", "setenta y dos", "setenta y tres", "setenta y cuatro", "setenta y cinco", "setenta y seis", "setenta y siete", "setenta y ocho", "setenta y nueve", "ochenta", "ochenta y uno", "ochenta y dos", "ochenta y tres", "ochenta y cuatro", "ochenta y cinco", "ochenta y seis", "ochenta y siete", "ochenta y ocho", "ochenta y nueve", "noventa", "noventa y uno", "noventa y dos", "noventa y tres", "noventa y cuatro", "noventa y cinco", "noventa y seis", "noventa y siete", "noventa y ocho", "noventa y nueve", "cien")
area_numerica <- as.character(6:100)
df <- df %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df_test <- df_test %>%
mutate(area = str_replace_all(area, setNames(area_numerica, area_escrita)))
df <- df %>%
mutate(area = as.integer(str_extract(area, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
df_test <- df_test %>%
mutate(area = as.integer(str_extract(area, "\\d+")))
df <- df %>%
mutate(area = ifelse(area > 1000| area < 25, NA, area))
df_test <- df_test %>%
mutate(area = ifelse(area > 1000 | area < 25, NA, area))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df$surface_total <- ifelse(is.na(df$surface_total), df$area, df$surface_total)
df_test$surface_total <- ifelse(is.na(df_test$surface_total), df_test$area, df_test$surface_total)
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df$surface_covered <- ifelse(is.na(df$surface_covered), df$area, df$surface_covered)
df_test$surface_covered <- ifelse(is.na(df_test$surface_covered), df_test$area, df_test$surface_covered)
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
condicion <- df$superficie_total < df$superficie_cubierta
df <- df %>%
mutate(condicion <- df$superficie_total < df$superficie_cubierta)
df <- df %>%
mutate(condicion <- superficie_total < superficie_cubierta)
df <- df %>%
mutate(condicion <- ifelse(superficie_total < superficie_cubierta)
df <- df %>%
df <- df %>%
mutate(condicion <- ifelse(superficie_total < superficie_cubierta))
df <- df %>%
mutate(condicion <- ifelse(df$superficie_total < df$superficie_cubierta))
df <- df %>%
mutate(condicion <- ifelse(surface_total < surface_covered))
df <- df %>%
mutate(condicion <- ifelse(surface_total < surface_covered, surface_covered, surface_total))
df$surface_total[df$surface_total < df$surface_covered] <- df$surface_covered[df$surface_total < df$surface_covered]
df$surface_total <- ifelse(is.na(df$surface_total) | is.na(df$surface_covered) | df$surface_total < df$surface_covered, df$surface_covered, df$surface_total)
df_test$surface_total <- ifelse(is.na(df_test$surface_total) | is.na(df_test$surface_covered) | df_test$surface_total < df_test$surface_covered, df_test$surface_covered, df_test$surface_total)
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df %>%
median(surface_total)
df %>%
median(df$surface_total)
df %>%
median(as.numeric(surface_total)
df %>%
df %>%
median(as.numeric(surface_total))
df$surface_total <- as.numeric(surface_total))
df$surface_total <- as.numeric(surface_total)
df$surface_total <- as.numeric(df$surface_total)
df %>%
median(surface_total)
mediana_sup_cubierta <- median(df$surface_covered, na.rm = TRUE) #108
mediana_sup_total <- median(df$surface_total, na.rm = TRUE) #119
mediana_sup_cubierta <- median(df_test$surface_covered, na.rm = TRUE) #108
mediana_sup_total <- median(df_test$surface_total, na.rm = TRUE) #110
mediana_sup_cubierta <- median(df$surface_covered, na.rm = TRUE) #108
mediana_sup_total <- median(df$surface_total, na.rm = TRUE) #110
mediana_sup_cubierta_test <- median(df_test$surface_covered, na.rm = TRUE) #108
mediana_sup_total_test <- median(df_test$surface_total, na.rm = TRUE) #110
df <- df %>%
mutate(surface_covered = replace_na(surface_covered, mediana_sup_cubierta),
surface_total = replace_na(surface_total, mediana_sup_total),)
df_test <- df_test %>%
mutate(surface_covered = replace_na(surface_covered, mediana_sup_cubierta_test),
surface_total = replace_na(surface_total, mediana_sup_total_test),)
df <- df %>%
mutate(bedrooms_info = str_extract(description, "(//w+|//d+) alcobas|(//w+|//d+) cuartos|(//w+|//d+) habitaciones"))
df <- df %>%
mutate(bedrooms_info = str_extract(description, "(//w+|//d+) alcobas|(//w+|//d+) cuartos|(//w+|//d+) habitaciones"))
df <- df %>%
mutate(bedrooms_info = str_extract(description, "(//w+|//d+) alcobas|(//w+|//d+) cuartos|(//w+|//d+) habitaciones"))
df <- df %>%
mutate(bedrooms_info = str_extract(description, "(\\w+|\\d+) alcobas|(\\w+|\\d+) cuartos|(\\w+|\\d+) habitaciones"))
cuartos_escritos <- c("uno|un", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve", "diez", "once")
cuartos_numericos <- as.character(1:11)
df <- df %>%
mutate(bedrooms_info = str_replace_all(bedrooms_info, setNames(cuartos_numericos, cuartos_escritos)))
df <- df %>%
mutate(bedrooms_info = as.integer(str_extract(bedrooms_info, "\\d+")))
df <- df %>%
mutate(bedrooms_info = str_extract(description, "(\\w+|\\d+) alcobas|(\\w+|\\d+) cuartos|(\\w+|\\d+) habitaciones|(\\w+|\\d+) dormitorios"))
cuartos_escritos <- c("uno|un", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve", "diez", "once")
cuartos_numericos <- as.character(1:11)
df <- df %>%
mutate(bedrooms_info = str_replace_all(bedrooms_info, setNames(cuartos_numericos, cuartos_escritos)))
df <- df %>%
mutate(bedrooms_info = as.integer(str_extract(bedrooms_info, "\\d+")))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(bathrooms_info = str_extract(description, "(\\w+|\\d+) baños|(\\w+|\\d+) baos|(\\w+|\\d+) banos|(\\w+|\\d+) lavabos"))
banos_escritos <- c("uno|un", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve", "diez", "once", "doce", "trece")
banos_numericos <- as.character(1:13)
df <- df %>%
mutate(bathrooms_info = str_replace_all(bathrooms_info, setNames(banos_numericos, banos_escritos)))
df <- df %>%
mutate(bathrooms_info = as.integer(str_extract(bathrooms_info, "\\d+")))
df <- df %>%
mutate(bathrooms_info = ifelse(bathrooms_info > 13, NA, bathrooms_info))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df$bathrooms <- ifelse(is.na(df$bathrooms), df$bathrooms_info, df$bathrooms)
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
count(df$bathrooms)
df %>%count(bathrooms) %>% head()
df <- df %>%
mutate(bathrooms = replace_na(bathrooms, 2))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df_test <- df_test %>%
mutate(bathrooms_info = str_extract(description, "(\\w+|\\d+) baños|(\\w+|\\d+) baos|(\\w+|\\d+) banos|(\\w+|\\d+) lavabos"))
df_test <- df_test %>%
mutate(bathrooms_info = str_replace_all(bathrooms_info, setNames(banos_numericos, banos_escritos)))
df_test <- df_test %>%
mutate(bathrooms_info = as.integer(str_extract(bathrooms_info, "\\d+")))
df_test <- df_test %>%
mutate(bathrooms_info = ifelse(bathrooms_info > 13, NA, bathrooms_info))
df_test$bathrooms <- ifelse(is.na(df$bathrooms), df_test$bathrooms_info, df_test$bathrooms)
df_test$bathrooms <- ifelse(is.na(df_test$bathrooms), df_test$bathrooms_info, df_test$bathrooms)
df_test %>%count(bathrooms) %>% head() #Moda es 2
df_test <- df_test %>%
mutate(bathrooms = replace_na(bathrooms, 2))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df_test <- df_test %>%
mutate(piso_info = str_extract(description, "(\\w+|\\d+) piso (\\w+|\\d+)"))
df_test <- df_test %>%
mutate(piso_info = str_replace_all(piso_info, setNames(numeros_numericos, numeros_escritos)))
df_test <- df_test %>%
mutate(piso_numerico = as.integer(str_extract(piso_info, "\\d+")))
df_test <- df_test %>%
mutate(piso_numerico = ifelse(piso_numerico > 40, NA, piso_numerico))
df_test %>%
filter(property_type_2 == "Apartamento") %>%
count(piso_numerico)
df_test <- df_test %>%
mutate(piso_numerico = replace_na(piso_numerico, 2))
sapply(df, function(x) sum(is.na(x)))
sapply(df_test, function(x) sum(is.na(x)))
df <- df %>%
mutate(precio_por_mt2 = round(price / surface_total, 0))
df <- df %>%
filter(between(precio_por_mt2, 600000,  15e6))
df_test <- df_test %>%
filter(between(precio_por_mt2, 600000,  15e6))
df_test <- df_test %>%
mutate(precio_por_mt2 = round(price / surface_total, 0))
df_test <- df_test %>%
filter(between(precio_por_mt2, 600000,  15e6))
library(pacman)
p_load(tidyverse,
rio,
tidymodels,
glmnet,
stargazer,
dplyr,
plotly,
leaflet,
rgeos,
tmaptools,
sf,
osmdata)
file_dir <- this.path::here()
setwd(file_dir)
df <- read_csv("../stores/train.csv")
df_test <- read_csv(("../stores/test.csv"))
df <- df %>%
mutate(precio_por_mt2 = round(price / surface_total, 0))
df <- df %>%
filter(between(precio_por_mt2, 600000,  15e6))
library(pacman)
p_load(tidyverse,
rio,
tidymodels,
glmnet,
stargazer,
dplyr,
plotly,
leaflet,
rgeos,
tmaptools,
sf,
osmdata)
file_dir <- this.path::here()
setwd(file_dir)
df <- read_csv("../stores/train.csv")
df_test <- read_csv(("../stores/test.csv"))
df <- df %>%
mutate(precio_por_mt2 = round(price / surface_total, 0))
View(df)
